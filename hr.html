<head>
</head>

<body>
    <button id="button">Click</button>
    <script>
        document.getElementById("button").addEventListener("click", () => {
            navigator.bluetooth.requestDevice({ filters: [{ services: ['heart_rate'] }] })
                .then(device => device.gatt.connect())
                .then(server => server.getPrimaryService('heart_rate'))
                .then(service => service.getCharacteristic('heart_rate_measurement'))
                .then(characteristic => characteristic.startNotifications())
                .then(characteristic => {
                    characteristic.addEventListener('characteristicvaluechanged',
                        handleCharacteristicValueChanged);
                    console.log('Notifications have been started.');
                })
                .catch(error => { console.error(error); });

            function handleCharacteristicValueChanged(event) {
                const value = event.target.value;
                console.log('Received ' + value);
                // https://developer.chrome.com/docs/capabilities/bluetooth
                // See https://github.com/WebBluetoothCG/demos/blob/gh-pages/heart-rate-sensor/heartRateSensor.js
            }
        });
    </script>
</body>